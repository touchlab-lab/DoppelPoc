//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: /Users/kgalligan/devel/xp/androidbase/AndroidBase/lib/src/main/java/android/database/sqlite/SQLiteCursor.java
//

#include "IOSClass.h"
#include "IOSObjectArray.h"
#include "J2ObjC_source.h"
#include "android/database/AbstractCursor.h"
#include "android/database/AbstractWindowedCursor.h"
#include "android/database/CursorWindow.h"
#include "android/database/DatabaseUtils.h"
#include "android/database/sqlite/SQLiteCursor.h"
#include "android/database/sqlite/SQLiteCursorDriver.h"
#include "android/database/sqlite/SQLiteDatabase.h"
#include "android/database/sqlite/SQLiteQuery.h"
#include "android/util/Log.h"
#include "java/lang/Deprecated.h"
#include "java/lang/Exception.h"
#include "java/lang/IllegalArgumentException.h"
#include "java/lang/IllegalStateException.h"
#include "java/lang/Integer.h"
#include "java/lang/RuntimeException.h"
#include "java/lang/annotation/Annotation.h"
#include "java/util/HashMap.h"
#include "java/util/Map.h"

@interface AndroidDatabaseSqliteSQLiteCursor () {
 @public
  NSString *mEditTable_;
  IOSObjectArray *mColumns_;
  AndroidDatabaseSqliteSQLiteQuery *mQuery_;
  id<AndroidDatabaseSqliteSQLiteCursorDriver> mDriver_;
  jint mCount_;
  jint mCursorWindowCapacity_;
  id<JavaUtilMap> mColumnNameMap_;
  NSException *mStackTrace_;
}

- (void)fillWindowWithInt:(jint)requiredPos;

@end

J2OBJC_FIELD_SETTER(AndroidDatabaseSqliteSQLiteCursor, mEditTable_, NSString *)
J2OBJC_FIELD_SETTER(AndroidDatabaseSqliteSQLiteCursor, mColumns_, IOSObjectArray *)
J2OBJC_FIELD_SETTER(AndroidDatabaseSqliteSQLiteCursor, mQuery_, AndroidDatabaseSqliteSQLiteQuery *)
J2OBJC_FIELD_SETTER(AndroidDatabaseSqliteSQLiteCursor, mDriver_, id<AndroidDatabaseSqliteSQLiteCursorDriver>)
J2OBJC_FIELD_SETTER(AndroidDatabaseSqliteSQLiteCursor, mColumnNameMap_, id<JavaUtilMap>)
J2OBJC_FIELD_SETTER(AndroidDatabaseSqliteSQLiteCursor, mStackTrace_, NSException *)

__attribute__((unused)) static void AndroidDatabaseSqliteSQLiteCursor_fillWindowWithInt_(AndroidDatabaseSqliteSQLiteCursor *self, jint requiredPos);

NSString *AndroidDatabaseSqliteSQLiteCursor_TAG = @"SQLiteCursor";

@implementation AndroidDatabaseSqliteSQLiteCursor

- (instancetype)initWithAndroidDatabaseSqliteSQLiteDatabase:(AndroidDatabaseSqliteSQLiteDatabase *)db
                withAndroidDatabaseSqliteSQLiteCursorDriver:(id<AndroidDatabaseSqliteSQLiteCursorDriver>)driver
                                               withNSString:(NSString *)editTable
                       withAndroidDatabaseSqliteSQLiteQuery:(AndroidDatabaseSqliteSQLiteQuery *)query {
  AndroidDatabaseSqliteSQLiteCursor_initWithAndroidDatabaseSqliteSQLiteDatabase_withAndroidDatabaseSqliteSQLiteCursorDriver_withNSString_withAndroidDatabaseSqliteSQLiteQuery_(self, db, driver, editTable, query);
  return self;
}

- (instancetype)initWithAndroidDatabaseSqliteSQLiteCursorDriver:(id<AndroidDatabaseSqliteSQLiteCursorDriver>)driver
                                                   withNSString:(NSString *)editTable
                           withAndroidDatabaseSqliteSQLiteQuery:(AndroidDatabaseSqliteSQLiteQuery *)query {
  AndroidDatabaseSqliteSQLiteCursor_initWithAndroidDatabaseSqliteSQLiteCursorDriver_withNSString_withAndroidDatabaseSqliteSQLiteQuery_(self, driver, editTable, query);
  return self;
}

- (AndroidDatabaseSqliteSQLiteDatabase *)getDatabase {
  return [((AndroidDatabaseSqliteSQLiteQuery *) nil_chk(mQuery_)) getDatabase];
}

- (jboolean)onMoveWithInt:(jint)oldPosition
                  withInt:(jint)newPosition {
  if (mWindow_ == nil || newPosition < [mWindow_ getStartPosition] || newPosition >= ([((AndroidDatabaseCursorWindow *) nil_chk(mWindow_)) getStartPosition] + [((AndroidDatabaseCursorWindow *) nil_chk(mWindow_)) getNumRows])) {
    AndroidDatabaseSqliteSQLiteCursor_fillWindowWithInt_(self, newPosition);
  }
  return true;
}

- (jint)getCount {
  if (mCount_ == AndroidDatabaseSqliteSQLiteCursor_NO_COUNT) {
    AndroidDatabaseSqliteSQLiteCursor_fillWindowWithInt_(self, 0);
  }
  return mCount_;
}

- (void)fillWindowWithInt:(jint)requiredPos {
  AndroidDatabaseSqliteSQLiteCursor_fillWindowWithInt_(self, requiredPos);
}

- (jint)getColumnIndexWithNSString:(NSString *)columnName {
  if (mColumnNameMap_ == nil) {
    IOSObjectArray *columns = mColumns_;
    jint columnCount = ((IOSObjectArray *) nil_chk(columns))->size_;
    JavaUtilHashMap *map = new_JavaUtilHashMap_initWithInt_withFloat_(columnCount, 1);
    for (jint i = 0; i < columnCount; i++) {
      (void) [map putWithId:IOSObjectArray_Get(columns, i) withId:JavaLangInteger_valueOfWithInt_(i)];
    }
    mColumnNameMap_ = map;
  }
  jint periodIndex = [((NSString *) nil_chk(columnName)) lastIndexOf:'.'];
  if (periodIndex != -1) {
    JavaLangException *e = new_JavaLangException_init();
    AndroidUtilLog_eWithNSString_withNSString_withNSException_(AndroidDatabaseSqliteSQLiteCursor_TAG, JreStrcat("$$", @"requesting column name with table name -- ", columnName), e);
    columnName = [columnName substring:periodIndex + 1];
  }
  JavaLangInteger *i = [((id<JavaUtilMap>) nil_chk(mColumnNameMap_)) getWithId:columnName];
  if (i != nil) {
    return [i intValue];
  }
  else {
    return -1;
  }
}

- (IOSObjectArray *)getColumnNames {
  return mColumns_;
}

- (void)deactivate {
  [super deactivate];
  [((id<AndroidDatabaseSqliteSQLiteCursorDriver>) nil_chk(mDriver_)) cursorDeactivated];
}

- (void)close {
  [super close];
  @synchronized(self) {
    [((AndroidDatabaseSqliteSQLiteQuery *) nil_chk(mQuery_)) close];
    [((id<AndroidDatabaseSqliteSQLiteCursorDriver>) nil_chk(mDriver_)) cursorClosed];
  }
}

- (jboolean)requery {
  if ([self isClosed]) {
    return false;
  }
  @synchronized(self) {
    if (![((AndroidDatabaseSqliteSQLiteDatabase *) nil_chk([((AndroidDatabaseSqliteSQLiteQuery *) nil_chk(mQuery_)) getDatabase])) isOpen]) {
      return false;
    }
    if (mWindow_ != nil) {
      [mWindow_ clear];
    }
    mPos_ = -1;
    mCount_ = AndroidDatabaseSqliteSQLiteCursor_NO_COUNT;
    [((id<AndroidDatabaseSqliteSQLiteCursorDriver>) nil_chk(mDriver_)) cursorRequeriedWithAndroidDatabaseCursor:self];
  }
  @try {
    return [super requery];
  }
  @catch (JavaLangIllegalStateException *e) {
    AndroidUtilLog_wWithNSString_withNSString_withNSException_(AndroidDatabaseSqliteSQLiteCursor_TAG, JreStrcat("$$", @"requery() failed ", [((JavaLangIllegalStateException *) nil_chk(e)) getMessage]), e);
    return false;
  }
}

- (void)setWindowWithAndroidDatabaseCursorWindow:(AndroidDatabaseCursorWindow *)window {
  [super setWindowWithAndroidDatabaseCursorWindow:window];
  mCount_ = AndroidDatabaseSqliteSQLiteCursor_NO_COUNT;
}

- (void)setSelectionArgumentsWithNSStringArray:(IOSObjectArray *)selectionArgs {
  [((id<AndroidDatabaseSqliteSQLiteCursorDriver>) nil_chk(mDriver_)) setBindArgumentsWithNSStringArray:selectionArgs];
}

- (void)javaFinalize {
  @try {
    if (mWindow_ != nil) {
      if (mStackTrace_ != nil) {
        NSString *sql = [((AndroidDatabaseSqliteSQLiteQuery *) nil_chk(mQuery_)) getSql];
        jint len = ((jint) [((NSString *) nil_chk(sql)) length]);
      }
      [self close];
    }
  }
  @finally {
    [super javaFinalize];
  }
}

+ (IOSObjectArray *)__annotations_initWithAndroidDatabaseSqliteSQLiteDatabase_withAndroidDatabaseSqliteSQLiteCursorDriver_withNSString_withAndroidDatabaseSqliteSQLiteQuery_ {
  return [IOSObjectArray newArrayWithObjects:(id[]){ create_JavaLangDeprecated() } count:1 type:JavaLangAnnotationAnnotation_class_()];
}

- (void)dealloc {
  JreCheckFinalize(self, [AndroidDatabaseSqliteSQLiteCursor class]);
}

+ (const J2ObjcClassInfo *)__metadata {
  static const J2ObjcMethodInfo methods[] = {
    { "initWithAndroidDatabaseSqliteSQLiteDatabase:withAndroidDatabaseSqliteSQLiteCursorDriver:withNSString:withAndroidDatabaseSqliteSQLiteQuery:", "SQLiteCursor", NULL, 0x1, NULL, NULL },
    { "initWithAndroidDatabaseSqliteSQLiteCursorDriver:withNSString:withAndroidDatabaseSqliteSQLiteQuery:", "SQLiteCursor", NULL, 0x1, NULL, NULL },
    { "getDatabase", NULL, "Landroid.database.sqlite.SQLiteDatabase;", 0x1, NULL, NULL },
    { "onMoveWithInt:withInt:", "onMove", "Z", 0x1, NULL, NULL },
    { "getCount", NULL, "I", 0x1, NULL, NULL },
    { "fillWindowWithInt:", "fillWindow", "V", 0x2, NULL, NULL },
    { "getColumnIndexWithNSString:", "getColumnIndex", "I", 0x1, NULL, NULL },
    { "getColumnNames", NULL, "[Ljava.lang.String;", 0x1, NULL, NULL },
    { "deactivate", NULL, "V", 0x1, NULL, NULL },
    { "close", NULL, "V", 0x1, NULL, NULL },
    { "requery", NULL, "Z", 0x1, NULL, NULL },
    { "setWindowWithAndroidDatabaseCursorWindow:", "setWindow", "V", 0x1, NULL, NULL },
    { "setSelectionArgumentsWithNSStringArray:", "setSelectionArguments", "V", 0x1, NULL, NULL },
    { "javaFinalize", "finalize", "V", 0x4, NULL, NULL },
  };
  static const J2ObjcFieldInfo fields[] = {
    { "TAG", "TAG", 0x18, "Ljava.lang.String;", &AndroidDatabaseSqliteSQLiteCursor_TAG, NULL, .constantValue.asLong = 0 },
    { "NO_COUNT", "NO_COUNT", 0x18, "I", NULL, NULL, .constantValue.asInt = AndroidDatabaseSqliteSQLiteCursor_NO_COUNT },
    { "mEditTable_", NULL, 0x12, "Ljava.lang.String;", NULL, NULL, .constantValue.asLong = 0 },
    { "mColumns_", NULL, 0x12, "[Ljava.lang.String;", NULL, NULL, .constantValue.asLong = 0 },
    { "mQuery_", NULL, 0x12, "Landroid.database.sqlite.SQLiteQuery;", NULL, NULL, .constantValue.asLong = 0 },
    { "mDriver_", NULL, 0x12, "Landroid.database.sqlite.SQLiteCursorDriver;", NULL, NULL, .constantValue.asLong = 0 },
    { "mCount_", NULL, 0x2, "I", NULL, NULL, .constantValue.asLong = 0 },
    { "mCursorWindowCapacity_", NULL, 0x2, "I", NULL, NULL, .constantValue.asLong = 0 },
    { "mColumnNameMap_", NULL, 0x2, "Ljava.util.Map;", NULL, "Ljava/util/Map<Ljava/lang/String;Ljava/lang/Integer;>;", .constantValue.asLong = 0 },
    { "mStackTrace_", NULL, 0x12, "Ljava.lang.Throwable;", NULL, NULL, .constantValue.asLong = 0 },
  };
  static const J2ObjcClassInfo _AndroidDatabaseSqliteSQLiteCursor = { 2, "SQLiteCursor", "android.database.sqlite", NULL, 0x1, 14, methods, 10, fields, 0, NULL, 0, NULL, NULL, NULL };
  return &_AndroidDatabaseSqliteSQLiteCursor;
}

@end

void AndroidDatabaseSqliteSQLiteCursor_initWithAndroidDatabaseSqliteSQLiteDatabase_withAndroidDatabaseSqliteSQLiteCursorDriver_withNSString_withAndroidDatabaseSqliteSQLiteQuery_(AndroidDatabaseSqliteSQLiteCursor *self, AndroidDatabaseSqliteSQLiteDatabase *db, id<AndroidDatabaseSqliteSQLiteCursorDriver> driver, NSString *editTable, AndroidDatabaseSqliteSQLiteQuery *query) {
  AndroidDatabaseSqliteSQLiteCursor_initWithAndroidDatabaseSqliteSQLiteCursorDriver_withNSString_withAndroidDatabaseSqliteSQLiteQuery_(self, driver, editTable, query);
}

AndroidDatabaseSqliteSQLiteCursor *new_AndroidDatabaseSqliteSQLiteCursor_initWithAndroidDatabaseSqliteSQLiteDatabase_withAndroidDatabaseSqliteSQLiteCursorDriver_withNSString_withAndroidDatabaseSqliteSQLiteQuery_(AndroidDatabaseSqliteSQLiteDatabase *db, id<AndroidDatabaseSqliteSQLiteCursorDriver> driver, NSString *editTable, AndroidDatabaseSqliteSQLiteQuery *query) {
  J2OBJC_NEW_IMPL(AndroidDatabaseSqliteSQLiteCursor, initWithAndroidDatabaseSqliteSQLiteDatabase_withAndroidDatabaseSqliteSQLiteCursorDriver_withNSString_withAndroidDatabaseSqliteSQLiteQuery_, db, driver, editTable, query)
}

AndroidDatabaseSqliteSQLiteCursor *create_AndroidDatabaseSqliteSQLiteCursor_initWithAndroidDatabaseSqliteSQLiteDatabase_withAndroidDatabaseSqliteSQLiteCursorDriver_withNSString_withAndroidDatabaseSqliteSQLiteQuery_(AndroidDatabaseSqliteSQLiteDatabase *db, id<AndroidDatabaseSqliteSQLiteCursorDriver> driver, NSString *editTable, AndroidDatabaseSqliteSQLiteQuery *query) {
  J2OBJC_CREATE_IMPL(AndroidDatabaseSqliteSQLiteCursor, initWithAndroidDatabaseSqliteSQLiteDatabase_withAndroidDatabaseSqliteSQLiteCursorDriver_withNSString_withAndroidDatabaseSqliteSQLiteQuery_, db, driver, editTable, query)
}

void AndroidDatabaseSqliteSQLiteCursor_initWithAndroidDatabaseSqliteSQLiteCursorDriver_withNSString_withAndroidDatabaseSqliteSQLiteQuery_(AndroidDatabaseSqliteSQLiteCursor *self, id<AndroidDatabaseSqliteSQLiteCursorDriver> driver, NSString *editTable, AndroidDatabaseSqliteSQLiteQuery *query) {
  AndroidDatabaseAbstractWindowedCursor_init(self);
  self->mCount_ = AndroidDatabaseSqliteSQLiteCursor_NO_COUNT;
  if (query == nil) {
    @throw new_JavaLangIllegalArgumentException_initWithNSString_(@"query object cannot be null");
  }
  {
    self->mStackTrace_ = nil;
  }
  self->mDriver_ = driver;
  self->mEditTable_ = editTable;
  self->mColumnNameMap_ = nil;
  self->mQuery_ = query;
  self->mColumns_ = [query getColumnNames];
}

AndroidDatabaseSqliteSQLiteCursor *new_AndroidDatabaseSqliteSQLiteCursor_initWithAndroidDatabaseSqliteSQLiteCursorDriver_withNSString_withAndroidDatabaseSqliteSQLiteQuery_(id<AndroidDatabaseSqliteSQLiteCursorDriver> driver, NSString *editTable, AndroidDatabaseSqliteSQLiteQuery *query) {
  J2OBJC_NEW_IMPL(AndroidDatabaseSqliteSQLiteCursor, initWithAndroidDatabaseSqliteSQLiteCursorDriver_withNSString_withAndroidDatabaseSqliteSQLiteQuery_, driver, editTable, query)
}

AndroidDatabaseSqliteSQLiteCursor *create_AndroidDatabaseSqliteSQLiteCursor_initWithAndroidDatabaseSqliteSQLiteCursorDriver_withNSString_withAndroidDatabaseSqliteSQLiteQuery_(id<AndroidDatabaseSqliteSQLiteCursorDriver> driver, NSString *editTable, AndroidDatabaseSqliteSQLiteQuery *query) {
  J2OBJC_CREATE_IMPL(AndroidDatabaseSqliteSQLiteCursor, initWithAndroidDatabaseSqliteSQLiteCursorDriver_withNSString_withAndroidDatabaseSqliteSQLiteQuery_, driver, editTable, query)
}

void AndroidDatabaseSqliteSQLiteCursor_fillWindowWithInt_(AndroidDatabaseSqliteSQLiteCursor *self, jint requiredPos) {
  [self clearOrCreateWindowWithNSString:[((AndroidDatabaseSqliteSQLiteDatabase *) nil_chk([self getDatabase])) getPath]];
  @try {
    if (self->mCount_ == AndroidDatabaseSqliteSQLiteCursor_NO_COUNT) {
      jint startPos = AndroidDatabaseDatabaseUtils_cursorPickFillWindowStartPositionWithInt_withInt_(requiredPos, 0);
      self->mCount_ = [((AndroidDatabaseSqliteSQLiteQuery *) nil_chk(self->mQuery_)) fillWindowWithAndroidDatabaseCursorWindow:self->mWindow_ withInt:startPos withInt:requiredPos withBoolean:true];
      self->mCursorWindowCapacity_ = [((AndroidDatabaseCursorWindow *) nil_chk(self->mWindow_)) getNumRows];
      if (AndroidUtilLog_isLoggableWithNSString_withInt_(AndroidDatabaseSqliteSQLiteCursor_TAG, AndroidUtilLog_DEBUG)) {
        AndroidUtilLog_dWithNSString_withNSString_(AndroidDatabaseSqliteSQLiteCursor_TAG, JreStrcat("$I", @"received count(*) from native_fill_window: ", self->mCount_));
      }
    }
    else {
      jint startPos = AndroidDatabaseDatabaseUtils_cursorPickFillWindowStartPositionWithInt_withInt_(requiredPos, self->mCursorWindowCapacity_);
      [((AndroidDatabaseSqliteSQLiteQuery *) nil_chk(self->mQuery_)) fillWindowWithAndroidDatabaseCursorWindow:self->mWindow_ withInt:startPos withInt:requiredPos withBoolean:false];
    }
  }
  @catch (JavaLangRuntimeException *ex) {
    [self closeWindow];
    @throw ex;
  }
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(AndroidDatabaseSqliteSQLiteCursor)
