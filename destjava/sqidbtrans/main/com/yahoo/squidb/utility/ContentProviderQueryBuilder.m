//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: /Users/kgalligan/devel/xp/squidb/squidb/src/com/yahoo/squidb/utility/ContentProviderQueryBuilder.java
//

#include "IOSClass.h"
#include "IOSObjectArray.h"
#include "J2ObjC_source.h"
#include "com/yahoo/squidb/sql/Criterion.h"
#include "com/yahoo/squidb/sql/Field.h"
#include "com/yahoo/squidb/sql/Order.h"
#include "com/yahoo/squidb/sql/Query.h"
#include "com/yahoo/squidb/sql/SqlTable.h"
#include "com/yahoo/squidb/sql/SqlUtils.h"
#include "com/yahoo/squidb/utility/ContentProviderQueryBuilder.h"
#include "com/yahoo/squidb/utility/ProjectionMap.h"
#include "java/lang/IllegalArgumentException.h"
#include "java/lang/IllegalStateException.h"
#include "java/util/ArrayList.h"
#include "java/util/List.h"

@interface ComYahooSquidbUtilityContentProviderQueryBuilder () {
 @public
  jboolean strictMode_;
  ComYahooSquidbUtilityProjectionMap *projectionMap_;
  ComYahooSquidbSqlSqlTable *dataSource_;
  IOSObjectArray *defaultOrder_;
}

- (id<JavaUtilList>)computeProjectionWithNSStringArray:(IOSObjectArray *)projectionIn;

@end

J2OBJC_FIELD_SETTER(ComYahooSquidbUtilityContentProviderQueryBuilder, projectionMap_, ComYahooSquidbUtilityProjectionMap *)
J2OBJC_FIELD_SETTER(ComYahooSquidbUtilityContentProviderQueryBuilder, dataSource_, ComYahooSquidbSqlSqlTable *)
J2OBJC_FIELD_SETTER(ComYahooSquidbUtilityContentProviderQueryBuilder, defaultOrder_, IOSObjectArray *)

__attribute__((unused)) static id<JavaUtilList> ComYahooSquidbUtilityContentProviderQueryBuilder_computeProjectionWithNSStringArray_(ComYahooSquidbUtilityContentProviderQueryBuilder *self, IOSObjectArray *projectionIn);

@implementation ComYahooSquidbUtilityContentProviderQueryBuilder

J2OBJC_IGNORE_DESIGNATED_BEGIN
- (instancetype)init {
  ComYahooSquidbUtilityContentProviderQueryBuilder_init(self);
  return self;
}
J2OBJC_IGNORE_DESIGNATED_END

- (instancetype)initWithComYahooSquidbSqlPropertyArray:(IOSObjectArray *)properties
                         withComYahooSquidbSqlSqlTable:(ComYahooSquidbSqlSqlTable *)dataSource {
  ComYahooSquidbUtilityContentProviderQueryBuilder_initWithComYahooSquidbSqlPropertyArray_withComYahooSquidbSqlSqlTable_(self, properties, dataSource);
  return self;
}

- (ComYahooSquidbUtilityContentProviderQueryBuilder *)setStrictWithBoolean:(jboolean)strict {
  self->strictMode_ = strict;
  return self;
}

- (ComYahooSquidbUtilityContentProviderQueryBuilder *)setProjectionMapWithComYahooSquidbUtilityProjectionMap:(ComYahooSquidbUtilityProjectionMap *)projectionMap {
  self->projectionMap_ = projectionMap;
  return self;
}

- (ComYahooSquidbUtilityContentProviderQueryBuilder *)setDataSourceWithComYahooSquidbSqlSqlTable:(ComYahooSquidbSqlSqlTable *)dataSource {
  self->dataSource_ = dataSource;
  return self;
}

- (ComYahooSquidbUtilityContentProviderQueryBuilder *)setDefaultOrderWithComYahooSquidbSqlOrderArray:(IOSObjectArray *)orders {
  if (orders == nil || orders->size_ == 0) {
    defaultOrder_ = nil;
  }
  else {
    defaultOrder_ = orders;
  }
  return self;
}

- (ComYahooSquidbSqlQuery *)buildWithNSStringArray:(IOSObjectArray *)projection
                                      withNSString:(NSString *)selection
                                 withNSStringArray:(IOSObjectArray *)selectionArgs
                                      withNSString:(NSString *)sortOrder {
  ComYahooSquidbSqlQuery *query = [((ComYahooSquidbSqlQuery *) nil_chk(ComYahooSquidbSqlQuery_selectWithJavaUtilList_(ComYahooSquidbUtilityContentProviderQueryBuilder_computeProjectionWithNSStringArray_(self, projection)))) fromWithComYahooSquidbSqlSqlTable:dataSource_];
  jboolean hasUserSelection = !ComYahooSquidbSqlSqlUtils_isEmptyWithNSString_(selection);
  if (hasUserSelection) {
    (void) [((ComYahooSquidbSqlQuery *) nil_chk(query)) whereWithComYahooSquidbSqlCriterion:ComYahooSquidbSqlCriterion_fromRawSelectionWithNSString_withNSStringArray_(selection, selectionArgs)];
  }
  if (!ComYahooSquidbSqlSqlUtils_isEmptyWithNSString_(sortOrder)) {
    (void) [((ComYahooSquidbSqlQuery *) nil_chk(query)) orderByWithComYahooSquidbSqlOrderArray:[IOSObjectArray newArrayWithObjects:(id[]){ ComYahooSquidbSqlOrder_fromExpressionWithNSString_(sortOrder) } count:1 type:ComYahooSquidbSqlOrder_class_()]];
  }
  else if (defaultOrder_ != nil && defaultOrder_->size_ > 0) {
    (void) [((ComYahooSquidbSqlQuery *) nil_chk(query)) orderByWithComYahooSquidbSqlOrderArray:defaultOrder_];
  }
  if (strictMode_ && hasUserSelection) {
    [((ComYahooSquidbSqlQuery *) nil_chk(query)) requestValidation];
  }
  return query;
}

- (id<JavaUtilList>)computeProjectionWithNSStringArray:(IOSObjectArray *)projectionIn {
  return ComYahooSquidbUtilityContentProviderQueryBuilder_computeProjectionWithNSStringArray_(self, projectionIn);
}

+ (const J2ObjcClassInfo *)__metadata {
  static const J2ObjcMethodInfo methods[] = {
    { "init", "ContentProviderQueryBuilder", NULL, 0x1, NULL, NULL },
    { "initWithComYahooSquidbSqlPropertyArray:withComYahooSquidbSqlSqlTable:", "ContentProviderQueryBuilder", NULL, 0x1, NULL, "([Lcom/yahoo/squidb/sql/Property<*>;Lcom/yahoo/squidb/sql/SqlTable<*>;)V" },
    { "setStrictWithBoolean:", "setStrict", "Lcom.yahoo.squidb.utility.ContentProviderQueryBuilder;", 0x1, NULL, NULL },
    { "setProjectionMapWithComYahooSquidbUtilityProjectionMap:", "setProjectionMap", "Lcom.yahoo.squidb.utility.ContentProviderQueryBuilder;", 0x1, NULL, NULL },
    { "setDataSourceWithComYahooSquidbSqlSqlTable:", "setDataSource", "Lcom.yahoo.squidb.utility.ContentProviderQueryBuilder;", 0x1, NULL, "(Lcom/yahoo/squidb/sql/SqlTable<*>;)Lcom/yahoo/squidb/utility/ContentProviderQueryBuilder;" },
    { "setDefaultOrderWithComYahooSquidbSqlOrderArray:", "setDefaultOrder", "Lcom.yahoo.squidb.utility.ContentProviderQueryBuilder;", 0x81, NULL, NULL },
    { "buildWithNSStringArray:withNSString:withNSStringArray:withNSString:", "build", "Lcom.yahoo.squidb.sql.Query;", 0x1, NULL, NULL },
    { "computeProjectionWithNSStringArray:", "computeProjection", "Ljava.util.List;", 0x2, NULL, "([Ljava/lang/String;)Ljava/util/List<Lcom/yahoo/squidb/sql/Field<*>;>;" },
  };
  static const J2ObjcFieldInfo fields[] = {
    { "strictMode_", NULL, 0x2, "Z", NULL, NULL, .constantValue.asLong = 0 },
    { "projectionMap_", NULL, 0x2, "Lcom.yahoo.squidb.utility.ProjectionMap;", NULL, NULL, .constantValue.asLong = 0 },
    { "dataSource_", NULL, 0x2, "Lcom.yahoo.squidb.sql.SqlTable;", NULL, "Lcom/yahoo/squidb/sql/SqlTable<*>;", .constantValue.asLong = 0 },
    { "defaultOrder_", NULL, 0x2, "[Lcom.yahoo.squidb.sql.Order;", NULL, NULL, .constantValue.asLong = 0 },
  };
  static const J2ObjcClassInfo _ComYahooSquidbUtilityContentProviderQueryBuilder = { 2, "ContentProviderQueryBuilder", "com.yahoo.squidb.utility", NULL, 0x1, 8, methods, 4, fields, 0, NULL, 0, NULL, NULL, NULL };
  return &_ComYahooSquidbUtilityContentProviderQueryBuilder;
}

@end

void ComYahooSquidbUtilityContentProviderQueryBuilder_init(ComYahooSquidbUtilityContentProviderQueryBuilder *self) {
  NSObject_init(self);
  self->strictMode_ = false;
  self->projectionMap_ = nil;
  self->dataSource_ = nil;
  self->defaultOrder_ = nil;
}

ComYahooSquidbUtilityContentProviderQueryBuilder *new_ComYahooSquidbUtilityContentProviderQueryBuilder_init() {
  ComYahooSquidbUtilityContentProviderQueryBuilder *self = [ComYahooSquidbUtilityContentProviderQueryBuilder alloc];
  ComYahooSquidbUtilityContentProviderQueryBuilder_init(self);
  return self;
}

ComYahooSquidbUtilityContentProviderQueryBuilder *create_ComYahooSquidbUtilityContentProviderQueryBuilder_init() {
  return new_ComYahooSquidbUtilityContentProviderQueryBuilder_init();
}

void ComYahooSquidbUtilityContentProviderQueryBuilder_initWithComYahooSquidbSqlPropertyArray_withComYahooSquidbSqlSqlTable_(ComYahooSquidbUtilityContentProviderQueryBuilder *self, IOSObjectArray *properties, ComYahooSquidbSqlSqlTable *dataSource) {
  NSObject_init(self);
  self->strictMode_ = false;
  self->projectionMap_ = nil;
  self->dataSource_ = nil;
  self->defaultOrder_ = nil;
  ComYahooSquidbUtilityProjectionMap *projectionMap = new_ComYahooSquidbUtilityProjectionMap_init();
  [projectionMap putAllWithComYahooSquidbSqlFieldArray:properties];
  (void) [self setProjectionMapWithComYahooSquidbUtilityProjectionMap:projectionMap];
  (void) [self setDataSourceWithComYahooSquidbSqlSqlTable:dataSource];
}

ComYahooSquidbUtilityContentProviderQueryBuilder *new_ComYahooSquidbUtilityContentProviderQueryBuilder_initWithComYahooSquidbSqlPropertyArray_withComYahooSquidbSqlSqlTable_(IOSObjectArray *properties, ComYahooSquidbSqlSqlTable *dataSource) {
  ComYahooSquidbUtilityContentProviderQueryBuilder *self = [ComYahooSquidbUtilityContentProviderQueryBuilder alloc];
  ComYahooSquidbUtilityContentProviderQueryBuilder_initWithComYahooSquidbSqlPropertyArray_withComYahooSquidbSqlSqlTable_(self, properties, dataSource);
  return self;
}

ComYahooSquidbUtilityContentProviderQueryBuilder *create_ComYahooSquidbUtilityContentProviderQueryBuilder_initWithComYahooSquidbSqlPropertyArray_withComYahooSquidbSqlSqlTable_(IOSObjectArray *properties, ComYahooSquidbSqlSqlTable *dataSource) {
  return new_ComYahooSquidbUtilityContentProviderQueryBuilder_initWithComYahooSquidbSqlPropertyArray_withComYahooSquidbSqlSqlTable_(properties, dataSource);
}

id<JavaUtilList> ComYahooSquidbUtilityContentProviderQueryBuilder_computeProjectionWithNSStringArray_(ComYahooSquidbUtilityContentProviderQueryBuilder *self, IOSObjectArray *projectionIn) {
  id<JavaUtilList> projection = nil;
  if (self->projectionMap_ == nil) {
    if (self->strictMode_) {
      @throw new_JavaLangIllegalStateException_initWithNSString_(@"Strict mode requires a projection map to be set");
    }
    if (projectionIn != nil && projectionIn->size_ > 0) {
      projection = new_JavaUtilArrayList_initWithInt_(projectionIn->size_);
      {
        IOSObjectArray *a__ = projectionIn;
        NSString * const *b__ = a__->buffer_;
        NSString * const *e__ = b__ + a__->size_;
        while (b__ < e__) {
          NSString *expression = *b__++;
          [projection addWithId:ComYahooSquidbSqlField_fieldWithNSString_(expression)];
        }
      }
    }
  }
  else {
    if (projectionIn == nil || projectionIn->size_ == 0) {
      projection = [self->projectionMap_ getDefaultProjection];
    }
    else {
      projection = new_JavaUtilArrayList_initWithInt_(projectionIn->size_);
      {
        IOSObjectArray *a__ = projectionIn;
        NSString * const *b__ = a__->buffer_;
        NSString * const *e__ = b__ + a__->size_;
        while (b__ < e__) {
          NSString *expression = *b__++;
          ComYahooSquidbSqlField *column = [self->projectionMap_ getWithNSString:expression];
          if (column != nil) {
            [projection addWithId:column];
          }
          else if (self->strictMode_) {
            @throw new_JavaLangIllegalArgumentException_initWithNSString_(JreStrcat("$$", @"Invalid column: ", expression));
          }
        }
      }
    }
  }
  return projection;
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(ComYahooSquidbUtilityContentProviderQueryBuilder)
