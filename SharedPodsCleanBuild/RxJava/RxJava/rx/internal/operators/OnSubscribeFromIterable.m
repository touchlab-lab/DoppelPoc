//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: /Users/kgalligan/devel/xp/RxJava/src/main/java/rx/internal/operators/OnSubscribeFromIterable.java
//

#include "IOSClass.h"
#include "J2ObjC_source.h"
#include "java/lang/Iterable.h"
#include "java/lang/Long.h"
#include "java/lang/NullPointerException.h"
#include "java/util/Iterator.h"
#include "java/util/concurrent/atomic/AtomicLongFieldUpdater.h"
#include "rx/Producer.h"
#include "rx/Subscriber.h"
#include "rx/internal/operators/OnSubscribeFromIterable.h"

@interface RxInternalOperatorsOnSubscribeFromIterable_IterableProducer : NSObject < RxProducer > {
 @public
  RxSubscriber *o_;
  id<JavaUtilIterator> it_;
  volatile_jlong requested_;
}

- (instancetype)initWithRxSubscriber:(RxSubscriber *)o
                withJavaUtilIterator:(id<JavaUtilIterator>)it;

- (void)requestWithLong:(jlong)n;

@end

J2OBJC_STATIC_INIT(RxInternalOperatorsOnSubscribeFromIterable_IterableProducer)

J2OBJC_FIELD_SETTER(RxInternalOperatorsOnSubscribeFromIterable_IterableProducer, o_, RxSubscriber *)
J2OBJC_FIELD_SETTER(RxInternalOperatorsOnSubscribeFromIterable_IterableProducer, it_, id<JavaUtilIterator>)

inline JavaUtilConcurrentAtomicAtomicLongFieldUpdater *RxInternalOperatorsOnSubscribeFromIterable_IterableProducer_get_REQUESTED_UPDATER();
static JavaUtilConcurrentAtomicAtomicLongFieldUpdater *RxInternalOperatorsOnSubscribeFromIterable_IterableProducer_REQUESTED_UPDATER;
J2OBJC_STATIC_FIELD_OBJ_FINAL(RxInternalOperatorsOnSubscribeFromIterable_IterableProducer, REQUESTED_UPDATER, JavaUtilConcurrentAtomicAtomicLongFieldUpdater *)

__attribute__((unused)) static void RxInternalOperatorsOnSubscribeFromIterable_IterableProducer_initWithRxSubscriber_withJavaUtilIterator_(RxInternalOperatorsOnSubscribeFromIterable_IterableProducer *self, RxSubscriber *o, id<JavaUtilIterator> it);

__attribute__((unused)) static RxInternalOperatorsOnSubscribeFromIterable_IterableProducer *new_RxInternalOperatorsOnSubscribeFromIterable_IterableProducer_initWithRxSubscriber_withJavaUtilIterator_(RxSubscriber *o, id<JavaUtilIterator> it) NS_RETURNS_RETAINED;

__attribute__((unused)) static RxInternalOperatorsOnSubscribeFromIterable_IterableProducer *create_RxInternalOperatorsOnSubscribeFromIterable_IterableProducer_initWithRxSubscriber_withJavaUtilIterator_(RxSubscriber *o, id<JavaUtilIterator> it);

J2OBJC_TYPE_LITERAL_HEADER(RxInternalOperatorsOnSubscribeFromIterable_IterableProducer)

@implementation RxInternalOperatorsOnSubscribeFromIterable

- (instancetype)initWithJavaLangIterable:(id<JavaLangIterable>)iterable {
  RxInternalOperatorsOnSubscribeFromIterable_initWithJavaLangIterable_(self, iterable);
  return self;
}

- (void)callWithId:(RxSubscriber *)o {
  id<JavaUtilIterator> it = [((id<JavaLangIterable>) nil_chk(is_)) iterator];
  [((RxSubscriber *) nil_chk(o)) setProducerWithRxProducer:new_RxInternalOperatorsOnSubscribeFromIterable_IterableProducer_initWithRxSubscriber_withJavaUtilIterator_(o, it)];
}

+ (const J2ObjcClassInfo *)__metadata {
  static const J2ObjcMethodInfo methods[] = {
    { "initWithJavaLangIterable:", "OnSubscribeFromIterable", NULL, 0x1, NULL, "(Ljava/lang/Iterable<+TT;>;)V" },
    { "callWithId:", "call", "V", 0x1, NULL, "(Lrx/Subscriber<-TT;>;)V" },
  };
  static const J2ObjcFieldInfo fields[] = {
    { "is_", NULL, 0x10, "Ljava.lang.Iterable;", NULL, "Ljava/lang/Iterable<+TT;>;", .constantValue.asLong = 0 },
  };
  static const char *inner_classes[] = {"Lrx.internal.operators.OnSubscribeFromIterable$IterableProducer;"};
  static const J2ObjcClassInfo _RxInternalOperatorsOnSubscribeFromIterable = { 2, "OnSubscribeFromIterable", "rx.internal.operators", NULL, 0x11, 2, methods, 1, fields, 0, NULL, 1, inner_classes, NULL, "<T:Ljava/lang/Object;>Ljava/lang/Object;Lrx/Observable$OnSubscribe<TT;>;" };
  return &_RxInternalOperatorsOnSubscribeFromIterable;
}

@end

void RxInternalOperatorsOnSubscribeFromIterable_initWithJavaLangIterable_(RxInternalOperatorsOnSubscribeFromIterable *self, id<JavaLangIterable> iterable) {
  NSObject_init(self);
  if (iterable == nil) {
    @throw new_JavaLangNullPointerException_initWithNSString_(@"iterable must not be null");
  }
  self->is_ = iterable;
}

RxInternalOperatorsOnSubscribeFromIterable *new_RxInternalOperatorsOnSubscribeFromIterable_initWithJavaLangIterable_(id<JavaLangIterable> iterable) {
  RxInternalOperatorsOnSubscribeFromIterable *self = [RxInternalOperatorsOnSubscribeFromIterable alloc];
  RxInternalOperatorsOnSubscribeFromIterable_initWithJavaLangIterable_(self, iterable);
  return self;
}

RxInternalOperatorsOnSubscribeFromIterable *create_RxInternalOperatorsOnSubscribeFromIterable_initWithJavaLangIterable_(id<JavaLangIterable> iterable) {
  return new_RxInternalOperatorsOnSubscribeFromIterable_initWithJavaLangIterable_(iterable);
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(RxInternalOperatorsOnSubscribeFromIterable)

J2OBJC_INITIALIZED_DEFN(RxInternalOperatorsOnSubscribeFromIterable_IterableProducer)

@implementation RxInternalOperatorsOnSubscribeFromIterable_IterableProducer

- (instancetype)initWithRxSubscriber:(RxSubscriber *)o
                withJavaUtilIterator:(id<JavaUtilIterator>)it {
  RxInternalOperatorsOnSubscribeFromIterable_IterableProducer_initWithRxSubscriber_withJavaUtilIterator_(self, o, it);
  return self;
}

- (void)requestWithLong:(jlong)n {
  if ([((JavaUtilConcurrentAtomicAtomicLongFieldUpdater *) nil_chk(RxInternalOperatorsOnSubscribeFromIterable_IterableProducer_REQUESTED_UPDATER)) getWithId:self] == JavaLangLong_MAX_VALUE) {
    return;
  }
  if (n == JavaLangLong_MAX_VALUE) {
    [RxInternalOperatorsOnSubscribeFromIterable_IterableProducer_REQUESTED_UPDATER setWithId:self withLong:n];
    while ([((id<JavaUtilIterator>) nil_chk(it_)) hasNext]) {
      if ([((RxSubscriber *) nil_chk(o_)) isUnsubscribed]) {
        return;
      }
      [o_ onNextWithId:[it_ next]];
    }
    if (![((RxSubscriber *) nil_chk(o_)) isUnsubscribed]) {
      [o_ onCompleted];
    }
  }
  else if (n > 0) {
    jlong _c = [RxInternalOperatorsOnSubscribeFromIterable_IterableProducer_REQUESTED_UPDATER getAndAddWithId:self withLong:n];
    if (_c == 0) {
      while (true) {
        jlong r = JreLoadVolatileLong(&requested_);
        jlong numToEmit = r;
        while ([((id<JavaUtilIterator>) nil_chk(it_)) hasNext] && --numToEmit >= 0) {
          if ([((RxSubscriber *) nil_chk(o_)) isUnsubscribed]) {
            return;
          }
          [o_ onNextWithId:[it_ next]];
        }
        if (![it_ hasNext]) {
          [((RxSubscriber *) nil_chk(o_)) onCompleted];
          return;
        }
        if ([RxInternalOperatorsOnSubscribeFromIterable_IterableProducer_REQUESTED_UPDATER addAndGetWithId:self withLong:-r] == 0) {
          return;
        }
      }
    }
  }
}

+ (void)initialize {
  if (self == [RxInternalOperatorsOnSubscribeFromIterable_IterableProducer class]) {
    RxInternalOperatorsOnSubscribeFromIterable_IterableProducer_REQUESTED_UPDATER = JavaUtilConcurrentAtomicAtomicLongFieldUpdater_newUpdaterWithIOSClass_withNSString_(RxInternalOperatorsOnSubscribeFromIterable_IterableProducer_class_(), @"requested");
    J2OBJC_SET_INITIALIZED(RxInternalOperatorsOnSubscribeFromIterable_IterableProducer)
  }
}

+ (const J2ObjcClassInfo *)__metadata {
  static const J2ObjcMethodInfo methods[] = {
    { "initWithRxSubscriber:withJavaUtilIterator:", "IterableProducer", NULL, 0x2, NULL, "(Lrx/Subscriber<-TT;>;Ljava/util/Iterator<+TT;>;)V" },
    { "requestWithLong:", "request", "V", 0x1, NULL, NULL },
  };
  static const J2ObjcFieldInfo fields[] = {
    { "o_", NULL, 0x12, "Lrx.Subscriber;", NULL, "Lrx/Subscriber<-TT;>;", .constantValue.asLong = 0 },
    { "it_", NULL, 0x12, "Ljava.util.Iterator;", NULL, "Ljava/util/Iterator<+TT;>;", .constantValue.asLong = 0 },
    { "requested_", NULL, 0x42, "J", NULL, NULL, .constantValue.asLong = 0 },
    { "REQUESTED_UPDATER", "REQUESTED_UPDATER", 0x1a, "Ljava.util.concurrent.atomic.AtomicLongFieldUpdater;", &RxInternalOperatorsOnSubscribeFromIterable_IterableProducer_REQUESTED_UPDATER, "Ljava/util/concurrent/atomic/AtomicLongFieldUpdater<Lrx/internal/operators/OnSubscribeFromIterable$IterableProducer;>;", .constantValue.asLong = 0 },
  };
  static const J2ObjcClassInfo _RxInternalOperatorsOnSubscribeFromIterable_IterableProducer = { 2, "IterableProducer", "rx.internal.operators", "OnSubscribeFromIterable", 0x1a, 2, methods, 4, fields, 0, NULL, 0, NULL, NULL, "<T:Ljava/lang/Object;>Ljava/lang/Object;Lrx/Producer;" };
  return &_RxInternalOperatorsOnSubscribeFromIterable_IterableProducer;
}

@end

void RxInternalOperatorsOnSubscribeFromIterable_IterableProducer_initWithRxSubscriber_withJavaUtilIterator_(RxInternalOperatorsOnSubscribeFromIterable_IterableProducer *self, RxSubscriber *o, id<JavaUtilIterator> it) {
  NSObject_init(self);
  JreAssignVolatileLong(&self->requested_, 0);
  self->o_ = o;
  self->it_ = it;
}

RxInternalOperatorsOnSubscribeFromIterable_IterableProducer *new_RxInternalOperatorsOnSubscribeFromIterable_IterableProducer_initWithRxSubscriber_withJavaUtilIterator_(RxSubscriber *o, id<JavaUtilIterator> it) {
  RxInternalOperatorsOnSubscribeFromIterable_IterableProducer *self = [RxInternalOperatorsOnSubscribeFromIterable_IterableProducer alloc];
  RxInternalOperatorsOnSubscribeFromIterable_IterableProducer_initWithRxSubscriber_withJavaUtilIterator_(self, o, it);
  return self;
}

RxInternalOperatorsOnSubscribeFromIterable_IterableProducer *create_RxInternalOperatorsOnSubscribeFromIterable_IterableProducer_initWithRxSubscriber_withJavaUtilIterator_(RxSubscriber *o, id<JavaUtilIterator> it) {
  return new_RxInternalOperatorsOnSubscribeFromIterable_IterableProducer_initWithRxSubscriber_withJavaUtilIterator_(o, it);
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(RxInternalOperatorsOnSubscribeFromIterable_IterableProducer)
