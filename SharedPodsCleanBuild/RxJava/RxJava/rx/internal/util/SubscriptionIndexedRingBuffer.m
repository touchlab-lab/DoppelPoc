//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: /Users/kgalligan/devel/xp/RxJava/src/main/java/rx/internal/util/SubscriptionIndexedRingBuffer.java
//

#include "IOSClass.h"
#include "IOSObjectArray.h"
#include "J2ObjC_source.h"
#include "java/lang/Boolean.h"
#include "java/util/concurrent/atomic/AtomicIntegerFieldUpdater.h"
#include "rx/Subscription.h"
#include "rx/functions/Func1.h"
#include "rx/internal/util/IndexedRingBuffer.h"
#include "rx/internal/util/SubscriptionIndexedRingBuffer.h"

@interface RxInternalUtilSubscriptionIndexedRingBuffer () {
 @public
  volatile_id subscriptions_;
  volatile_jint unsubscribed_;
}

+ (void)unsubscribeFromAllWithRxInternalUtilIndexedRingBuffer:(RxInternalUtilIndexedRingBuffer *)subscriptions;

@end

J2OBJC_VOLATILE_FIELD_SETTER(RxInternalUtilSubscriptionIndexedRingBuffer, subscriptions_, RxInternalUtilIndexedRingBuffer *)

inline JavaUtilConcurrentAtomicAtomicIntegerFieldUpdater *RxInternalUtilSubscriptionIndexedRingBuffer_get_UNSUBSCRIBED();
static JavaUtilConcurrentAtomicAtomicIntegerFieldUpdater *RxInternalUtilSubscriptionIndexedRingBuffer_UNSUBSCRIBED;
J2OBJC_STATIC_FIELD_OBJ_FINAL(RxInternalUtilSubscriptionIndexedRingBuffer, UNSUBSCRIBED, JavaUtilConcurrentAtomicAtomicIntegerFieldUpdater *)

inline id<RxFunctionsFunc1> RxInternalUtilSubscriptionIndexedRingBuffer_get_UNSUBSCRIBE();
static id<RxFunctionsFunc1> RxInternalUtilSubscriptionIndexedRingBuffer_UNSUBSCRIBE;
J2OBJC_STATIC_FIELD_OBJ_FINAL(RxInternalUtilSubscriptionIndexedRingBuffer, UNSUBSCRIBE, id<RxFunctionsFunc1>)

__attribute__((unused)) static void RxInternalUtilSubscriptionIndexedRingBuffer_unsubscribeFromAllWithRxInternalUtilIndexedRingBuffer_(RxInternalUtilIndexedRingBuffer *subscriptions);

@interface RxInternalUtilSubscriptionIndexedRingBuffer_$1 : NSObject < RxFunctionsFunc1 >

- (JavaLangBoolean *)callWithId:(id<RxSubscription>)s;

- (instancetype)init;

@end

J2OBJC_EMPTY_STATIC_INIT(RxInternalUtilSubscriptionIndexedRingBuffer_$1)

__attribute__((unused)) static void RxInternalUtilSubscriptionIndexedRingBuffer_$1_init(RxInternalUtilSubscriptionIndexedRingBuffer_$1 *self);

__attribute__((unused)) static RxInternalUtilSubscriptionIndexedRingBuffer_$1 *new_RxInternalUtilSubscriptionIndexedRingBuffer_$1_init() NS_RETURNS_RETAINED;

__attribute__((unused)) static RxInternalUtilSubscriptionIndexedRingBuffer_$1 *create_RxInternalUtilSubscriptionIndexedRingBuffer_$1_init();

J2OBJC_TYPE_LITERAL_HEADER(RxInternalUtilSubscriptionIndexedRingBuffer_$1)

J2OBJC_INITIALIZED_DEFN(RxInternalUtilSubscriptionIndexedRingBuffer)

@implementation RxInternalUtilSubscriptionIndexedRingBuffer

J2OBJC_IGNORE_DESIGNATED_BEGIN
- (instancetype)init {
  RxInternalUtilSubscriptionIndexedRingBuffer_init(self);
  return self;
}
J2OBJC_IGNORE_DESIGNATED_END

- (instancetype)initWithRxSubscriptionArray:(IOSObjectArray *)subscriptions {
  RxInternalUtilSubscriptionIndexedRingBuffer_initWithRxSubscriptionArray_(self, subscriptions);
  return self;
}

- (jboolean)isUnsubscribed {
  return JreLoadVolatileInt(&unsubscribed_) == 1;
}

- (jint)addWithRxSubscription:(id<RxSubscription>)s {
  @synchronized(self) {
    if (JreLoadVolatileInt(&unsubscribed_) == 1 || JreLoadVolatileId(&subscriptions_) == nil) {
      [((id<RxSubscription>) nil_chk(s)) unsubscribe];
      return -1;
    }
    else {
      jint n = [((RxInternalUtilIndexedRingBuffer *) JreLoadVolatileId(&subscriptions_)) addWithId:s];
      if (JreLoadVolatileInt(&unsubscribed_) == 1) {
        [((id<RxSubscription>) nil_chk(s)) unsubscribe];
      }
      return n;
    }
  }
}

- (void)removeWithInt:(jint)n {
  if (JreLoadVolatileInt(&unsubscribed_) == 1 || JreLoadVolatileId(&subscriptions_) == nil || n < 0) {
    return;
  }
  id<RxSubscription> t = [((RxInternalUtilIndexedRingBuffer *) nil_chk(JreLoadVolatileId(&subscriptions_))) removeWithInt:n];
  if (t != nil) {
    if (t != nil) {
      [t unsubscribe];
    }
  }
}

- (void)removeSilentlyWithInt:(jint)n {
  if (JreLoadVolatileInt(&unsubscribed_) == 1 || JreLoadVolatileId(&subscriptions_) == nil || n < 0) {
    return;
  }
  (void) [((RxInternalUtilIndexedRingBuffer *) nil_chk(JreLoadVolatileId(&subscriptions_))) removeWithInt:n];
}

- (void)unsubscribe {
  if ([((JavaUtilConcurrentAtomicAtomicIntegerFieldUpdater *) nil_chk(RxInternalUtilSubscriptionIndexedRingBuffer_UNSUBSCRIBED)) compareAndSetWithId:self withInt:0 withInt:1] && JreLoadVolatileId(&subscriptions_) != nil) {
    RxInternalUtilSubscriptionIndexedRingBuffer_unsubscribeFromAllWithRxInternalUtilIndexedRingBuffer_(JreLoadVolatileId(&subscriptions_));
    RxInternalUtilIndexedRingBuffer *s = JreLoadVolatileId(&subscriptions_);
    (void) JreVolatileStrongAssign(&subscriptions_, nil);
    [s unsubscribe];
  }
}

- (jint)forEachWithRxFunctionsFunc1:(id<RxFunctionsFunc1>)action {
  return [self forEachWithRxFunctionsFunc1:action withInt:0];
}

- (jint)forEachWithRxFunctionsFunc1:(id<RxFunctionsFunc1>)action
                            withInt:(jint)startIndex {
  @synchronized(self) {
    if (JreLoadVolatileInt(&unsubscribed_) == 1 || JreLoadVolatileId(&subscriptions_) == nil) {
      return 0;
    }
    return [((RxInternalUtilIndexedRingBuffer *) nil_chk(JreLoadVolatileId(&subscriptions_))) forEachWithRxFunctionsFunc1:action withInt:startIndex];
  }
}

+ (void)unsubscribeFromAllWithRxInternalUtilIndexedRingBuffer:(RxInternalUtilIndexedRingBuffer *)subscriptions {
  RxInternalUtilSubscriptionIndexedRingBuffer_unsubscribeFromAllWithRxInternalUtilIndexedRingBuffer_(subscriptions);
}

- (void)dealloc {
  JreReleaseVolatile(&subscriptions_);
}

- (void)__javaClone:(RxInternalUtilSubscriptionIndexedRingBuffer *)original {
  [super __javaClone:original];
  JreCloneVolatileStrong(&subscriptions_, &original->subscriptions_);
}

+ (void)initialize {
  if (self == [RxInternalUtilSubscriptionIndexedRingBuffer class]) {
    RxInternalUtilSubscriptionIndexedRingBuffer_UNSUBSCRIBED = JavaUtilConcurrentAtomicAtomicIntegerFieldUpdater_newUpdaterWithIOSClass_withNSString_(RxInternalUtilSubscriptionIndexedRingBuffer_class_(), @"unsubscribed");
    RxInternalUtilSubscriptionIndexedRingBuffer_UNSUBSCRIBE = new_RxInternalUtilSubscriptionIndexedRingBuffer_$1_init();
    J2OBJC_SET_INITIALIZED(RxInternalUtilSubscriptionIndexedRingBuffer)
  }
}

+ (const J2ObjcClassInfo *)__metadata {
  static const J2ObjcMethodInfo methods[] = {
    { "init", "SubscriptionIndexedRingBuffer", NULL, 0x1, NULL, NULL },
    { "initWithRxSubscriptionArray:", "SubscriptionIndexedRingBuffer", NULL, 0x81, NULL, NULL },
    { "isUnsubscribed", NULL, "Z", 0x1, NULL, NULL },
    { "addWithRxSubscription:", "add", "I", 0x21, NULL, "(TT;)I" },
    { "removeWithInt:", "remove", "V", 0x1, NULL, NULL },
    { "removeSilentlyWithInt:", "removeSilently", "V", 0x1, NULL, NULL },
    { "unsubscribe", NULL, "V", 0x1, NULL, NULL },
    { "forEachWithRxFunctionsFunc1:", "forEach", "I", 0x1, NULL, "(Lrx/functions/Func1<TT;Ljava/lang/Boolean;>;)I" },
    { "forEachWithRxFunctionsFunc1:withInt:", "forEach", "I", 0x21, NULL, "(Lrx/functions/Func1<TT;Ljava/lang/Boolean;>;I)I" },
    { "unsubscribeFromAllWithRxInternalUtilIndexedRingBuffer:", "unsubscribeFromAll", "V", 0xa, NULL, "(Lrx/internal/util/IndexedRingBuffer<+Lrx/Subscription;>;)V" },
  };
  static const J2ObjcFieldInfo fields[] = {
    { "subscriptions_", NULL, 0x42, "Lrx.internal.util.IndexedRingBuffer;", NULL, "Lrx/internal/util/IndexedRingBuffer<TT;>;", .constantValue.asLong = 0 },
    { "unsubscribed_", NULL, 0x42, "I", NULL, NULL, .constantValue.asLong = 0 },
    { "UNSUBSCRIBED", "UNSUBSCRIBED", 0x1a, "Ljava.util.concurrent.atomic.AtomicIntegerFieldUpdater;", &RxInternalUtilSubscriptionIndexedRingBuffer_UNSUBSCRIBED, "Ljava/util/concurrent/atomic/AtomicIntegerFieldUpdater<Lrx/internal/util/SubscriptionIndexedRingBuffer;>;", .constantValue.asLong = 0 },
    { "UNSUBSCRIBE", "UNSUBSCRIBE", 0x1a, "Lrx.functions.Func1;", &RxInternalUtilSubscriptionIndexedRingBuffer_UNSUBSCRIBE, "Lrx/functions/Func1<Lrx/Subscription;Ljava/lang/Boolean;>;", .constantValue.asLong = 0 },
  };
  static const J2ObjcClassInfo _RxInternalUtilSubscriptionIndexedRingBuffer = { 2, "SubscriptionIndexedRingBuffer", "rx.internal.util", NULL, 0x11, 10, methods, 4, fields, 0, NULL, 0, NULL, NULL, "<T::Lrx/Subscription;>Ljava/lang/Object;Lrx/Subscription;" };
  return &_RxInternalUtilSubscriptionIndexedRingBuffer;
}

@end

void RxInternalUtilSubscriptionIndexedRingBuffer_init(RxInternalUtilSubscriptionIndexedRingBuffer *self) {
  NSObject_init(self);
  (void) JreVolatileStrongAssign(&self->subscriptions_, RxInternalUtilIndexedRingBuffer_getInstance());
  JreAssignVolatileInt(&self->unsubscribed_, 0);
}

RxInternalUtilSubscriptionIndexedRingBuffer *new_RxInternalUtilSubscriptionIndexedRingBuffer_init() {
  RxInternalUtilSubscriptionIndexedRingBuffer *self = [RxInternalUtilSubscriptionIndexedRingBuffer alloc];
  RxInternalUtilSubscriptionIndexedRingBuffer_init(self);
  return self;
}

RxInternalUtilSubscriptionIndexedRingBuffer *create_RxInternalUtilSubscriptionIndexedRingBuffer_init() {
  return new_RxInternalUtilSubscriptionIndexedRingBuffer_init();
}

void RxInternalUtilSubscriptionIndexedRingBuffer_initWithRxSubscriptionArray_(RxInternalUtilSubscriptionIndexedRingBuffer *self, IOSObjectArray *subscriptions) {
  NSObject_init(self);
  (void) JreVolatileStrongAssign(&self->subscriptions_, RxInternalUtilIndexedRingBuffer_getInstance());
  JreAssignVolatileInt(&self->unsubscribed_, 0);
  {
    IOSObjectArray *a__ = subscriptions;
    id<RxSubscription> const *b__ = ((IOSObjectArray *) nil_chk(a__))->buffer_;
    id<RxSubscription> const *e__ = b__ + a__->size_;
    while (b__ < e__) {
      id<RxSubscription> t = *b__++;
      [((RxInternalUtilIndexedRingBuffer *) nil_chk(JreLoadVolatileId(&self->subscriptions_))) addWithId:t];
    }
  }
}

RxInternalUtilSubscriptionIndexedRingBuffer *new_RxInternalUtilSubscriptionIndexedRingBuffer_initWithRxSubscriptionArray_(IOSObjectArray *subscriptions) {
  RxInternalUtilSubscriptionIndexedRingBuffer *self = [RxInternalUtilSubscriptionIndexedRingBuffer alloc];
  RxInternalUtilSubscriptionIndexedRingBuffer_initWithRxSubscriptionArray_(self, subscriptions);
  return self;
}

RxInternalUtilSubscriptionIndexedRingBuffer *create_RxInternalUtilSubscriptionIndexedRingBuffer_initWithRxSubscriptionArray_(IOSObjectArray *subscriptions) {
  return new_RxInternalUtilSubscriptionIndexedRingBuffer_initWithRxSubscriptionArray_(subscriptions);
}

void RxInternalUtilSubscriptionIndexedRingBuffer_unsubscribeFromAllWithRxInternalUtilIndexedRingBuffer_(RxInternalUtilIndexedRingBuffer *subscriptions) {
  RxInternalUtilSubscriptionIndexedRingBuffer_initialize();
  if (subscriptions == nil) {
    return;
  }
  [((RxInternalUtilIndexedRingBuffer *) nil_chk(subscriptions)) forEachWithRxFunctionsFunc1:RxInternalUtilSubscriptionIndexedRingBuffer_UNSUBSCRIBE];
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(RxInternalUtilSubscriptionIndexedRingBuffer)

@implementation RxInternalUtilSubscriptionIndexedRingBuffer_$1

- (JavaLangBoolean *)callWithId:(id<RxSubscription>)s {
  [((id<RxSubscription>) nil_chk(s)) unsubscribe];
  return JreLoadStatic(JavaLangBoolean, TRUE);
}

J2OBJC_IGNORE_DESIGNATED_BEGIN
- (instancetype)init {
  RxInternalUtilSubscriptionIndexedRingBuffer_$1_init(self);
  return self;
}
J2OBJC_IGNORE_DESIGNATED_END

+ (const J2ObjcClassInfo *)__metadata {
  static const J2ObjcMethodInfo methods[] = {
    { "callWithId:", "call", "Ljava.lang.Boolean;", 0x1, NULL, NULL },
    { "init", "", NULL, 0x0, NULL, NULL },
  };
  static const J2ObjcClassInfo _RxInternalUtilSubscriptionIndexedRingBuffer_$1 = { 2, "", "rx.internal.util", "SubscriptionIndexedRingBuffer", 0x8008, 2, methods, 0, NULL, 0, NULL, 0, NULL, NULL, "Ljava/lang/Object;Lrx/functions/Func1<Lrx/Subscription;Ljava/lang/Boolean;>;" };
  return &_RxInternalUtilSubscriptionIndexedRingBuffer_$1;
}

@end

void RxInternalUtilSubscriptionIndexedRingBuffer_$1_init(RxInternalUtilSubscriptionIndexedRingBuffer_$1 *self) {
  NSObject_init(self);
}

RxInternalUtilSubscriptionIndexedRingBuffer_$1 *new_RxInternalUtilSubscriptionIndexedRingBuffer_$1_init() {
  RxInternalUtilSubscriptionIndexedRingBuffer_$1 *self = [RxInternalUtilSubscriptionIndexedRingBuffer_$1 alloc];
  RxInternalUtilSubscriptionIndexedRingBuffer_$1_init(self);
  return self;
}

RxInternalUtilSubscriptionIndexedRingBuffer_$1 *create_RxInternalUtilSubscriptionIndexedRingBuffer_$1_init() {
  return new_RxInternalUtilSubscriptionIndexedRingBuffer_$1_init();
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(RxInternalUtilSubscriptionIndexedRingBuffer_$1)
