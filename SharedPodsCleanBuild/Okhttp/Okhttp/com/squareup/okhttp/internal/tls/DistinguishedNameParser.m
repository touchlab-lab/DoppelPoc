//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: /Users/kgalligan/devel/xp/sourcejava/okhttp/okhttp/src/main/java/com/squareup/okhttp/internal/tls/DistinguishedNameParser.java
//

#include "IOSPrimitiveArray.h"
#include "J2ObjC_source.h"
#include "com/squareup/okhttp/internal/tls/DistinguishedNameParser.h"
#include "java/lang/IllegalStateException.h"
#include "javax/security/auth/x500/X500Principal.h"

@interface ComSquareupOkhttpInternalTlsDistinguishedNameParser () {
 @public
  NSString *dn_;
  jint length_;
  jint pos_;
  jint beg_;
  jint end_;
  jint cur_;
  IOSCharArray *chars_;
}

- (NSString *)nextAT;

- (NSString *)quotedAV;

- (NSString *)hexAV;

- (NSString *)escapedAV;

- (jchar)getEscaped;

- (jchar)getUTF8;

- (jint)getByteWithInt:(jint)position;

@end

J2OBJC_FIELD_SETTER(ComSquareupOkhttpInternalTlsDistinguishedNameParser, dn_, NSString *)
J2OBJC_FIELD_SETTER(ComSquareupOkhttpInternalTlsDistinguishedNameParser, chars_, IOSCharArray *)

__attribute__((unused)) static NSString *ComSquareupOkhttpInternalTlsDistinguishedNameParser_nextAT(ComSquareupOkhttpInternalTlsDistinguishedNameParser *self);

__attribute__((unused)) static NSString *ComSquareupOkhttpInternalTlsDistinguishedNameParser_quotedAV(ComSquareupOkhttpInternalTlsDistinguishedNameParser *self);

__attribute__((unused)) static NSString *ComSquareupOkhttpInternalTlsDistinguishedNameParser_hexAV(ComSquareupOkhttpInternalTlsDistinguishedNameParser *self);

__attribute__((unused)) static NSString *ComSquareupOkhttpInternalTlsDistinguishedNameParser_escapedAV(ComSquareupOkhttpInternalTlsDistinguishedNameParser *self);

__attribute__((unused)) static jchar ComSquareupOkhttpInternalTlsDistinguishedNameParser_getEscaped(ComSquareupOkhttpInternalTlsDistinguishedNameParser *self);

__attribute__((unused)) static jchar ComSquareupOkhttpInternalTlsDistinguishedNameParser_getUTF8(ComSquareupOkhttpInternalTlsDistinguishedNameParser *self);

__attribute__((unused)) static jint ComSquareupOkhttpInternalTlsDistinguishedNameParser_getByteWithInt_(ComSquareupOkhttpInternalTlsDistinguishedNameParser *self, jint position);

@implementation ComSquareupOkhttpInternalTlsDistinguishedNameParser

- (instancetype)initWithJavaxSecurityAuthX500X500Principal:(JavaxSecurityAuthX500X500Principal *)principal {
  ComSquareupOkhttpInternalTlsDistinguishedNameParser_initWithJavaxSecurityAuthX500X500Principal_(self, principal);
  return self;
}

- (NSString *)nextAT {
  return ComSquareupOkhttpInternalTlsDistinguishedNameParser_nextAT(self);
}

- (NSString *)quotedAV {
  return ComSquareupOkhttpInternalTlsDistinguishedNameParser_quotedAV(self);
}

- (NSString *)hexAV {
  return ComSquareupOkhttpInternalTlsDistinguishedNameParser_hexAV(self);
}

- (NSString *)escapedAV {
  return ComSquareupOkhttpInternalTlsDistinguishedNameParser_escapedAV(self);
}

- (jchar)getEscaped {
  return ComSquareupOkhttpInternalTlsDistinguishedNameParser_getEscaped(self);
}

- (jchar)getUTF8 {
  return ComSquareupOkhttpInternalTlsDistinguishedNameParser_getUTF8(self);
}

- (jint)getByteWithInt:(jint)position {
  return ComSquareupOkhttpInternalTlsDistinguishedNameParser_getByteWithInt_(self, position);
}

- (NSString *)findMostSpecificWithNSString:(NSString *)attributeType {
  pos_ = 0;
  beg_ = 0;
  end_ = 0;
  cur_ = 0;
  chars_ = [((NSString *) nil_chk(dn_)) toCharArray];
  NSString *attType = ComSquareupOkhttpInternalTlsDistinguishedNameParser_nextAT(self);
  if (attType == nil) {
    return nil;
  }
  while (true) {
    NSString *attValue = @"";
    if (pos_ == length_) {
      return nil;
    }
    switch (IOSCharArray_Get(nil_chk(chars_), pos_)) {
      case '"':
      attValue = ComSquareupOkhttpInternalTlsDistinguishedNameParser_quotedAV(self);
      break;
      case '#':
      attValue = ComSquareupOkhttpInternalTlsDistinguishedNameParser_hexAV(self);
      break;
      case '+':
      case ',':
      case ';':
      break;
      default:
      attValue = ComSquareupOkhttpInternalTlsDistinguishedNameParser_escapedAV(self);
    }
    if ([((NSString *) nil_chk(attributeType)) equalsIgnoreCase:attType]) {
      return attValue;
    }
    if (pos_ >= length_) {
      return nil;
    }
    if (IOSCharArray_Get(chars_, pos_) == ',' || IOSCharArray_Get(chars_, pos_) == ';') {
    }
    else if (IOSCharArray_Get(chars_, pos_) != '+') {
      @throw new_JavaLangIllegalStateException_initWithNSString_(JreStrcat("$$", @"Malformed DN: ", dn_));
    }
    pos_++;
    attType = ComSquareupOkhttpInternalTlsDistinguishedNameParser_nextAT(self);
    if (attType == nil) {
      @throw new_JavaLangIllegalStateException_initWithNSString_(JreStrcat("$$", @"Malformed DN: ", dn_));
    }
  }
}

+ (const J2ObjcClassInfo *)__metadata {
  static const J2ObjcMethodInfo methods[] = {
    { "initWithJavaxSecurityAuthX500X500Principal:", "DistinguishedNameParser", NULL, 0x1, NULL, NULL },
    { "nextAT", NULL, "Ljava.lang.String;", 0x2, NULL, NULL },
    { "quotedAV", NULL, "Ljava.lang.String;", 0x2, NULL, NULL },
    { "hexAV", NULL, "Ljava.lang.String;", 0x2, NULL, NULL },
    { "escapedAV", NULL, "Ljava.lang.String;", 0x2, NULL, NULL },
    { "getEscaped", NULL, "C", 0x2, NULL, NULL },
    { "getUTF8", NULL, "C", 0x2, NULL, NULL },
    { "getByteWithInt:", "getByte", "I", 0x2, NULL, NULL },
    { "findMostSpecificWithNSString:", "findMostSpecific", "Ljava.lang.String;", 0x1, NULL, NULL },
  };
  static const J2ObjcFieldInfo fields[] = {
    { "dn_", NULL, 0x12, "Ljava.lang.String;", NULL, NULL, .constantValue.asLong = 0 },
    { "length_", NULL, 0x12, "I", NULL, NULL, .constantValue.asLong = 0 },
    { "pos_", NULL, 0x2, "I", NULL, NULL, .constantValue.asLong = 0 },
    { "beg_", NULL, 0x2, "I", NULL, NULL, .constantValue.asLong = 0 },
    { "end_", NULL, 0x2, "I", NULL, NULL, .constantValue.asLong = 0 },
    { "cur_", NULL, 0x2, "I", NULL, NULL, .constantValue.asLong = 0 },
    { "chars_", NULL, 0x2, "[C", NULL, NULL, .constantValue.asLong = 0 },
  };
  static const J2ObjcClassInfo _ComSquareupOkhttpInternalTlsDistinguishedNameParser = { 2, "DistinguishedNameParser", "com.squareup.okhttp.internal.tls", NULL, 0x10, 9, methods, 7, fields, 0, NULL, 0, NULL, NULL, NULL };
  return &_ComSquareupOkhttpInternalTlsDistinguishedNameParser;
}

@end

void ComSquareupOkhttpInternalTlsDistinguishedNameParser_initWithJavaxSecurityAuthX500X500Principal_(ComSquareupOkhttpInternalTlsDistinguishedNameParser *self, JavaxSecurityAuthX500X500Principal *principal) {
  NSObject_init(self);
  self->dn_ = [((JavaxSecurityAuthX500X500Principal *) nil_chk(principal)) getNameWithNSString:JavaxSecurityAuthX500X500Principal_RFC2253];
  self->length_ = ((jint) [((NSString *) nil_chk(self->dn_)) length]);
}

ComSquareupOkhttpInternalTlsDistinguishedNameParser *new_ComSquareupOkhttpInternalTlsDistinguishedNameParser_initWithJavaxSecurityAuthX500X500Principal_(JavaxSecurityAuthX500X500Principal *principal) {
  ComSquareupOkhttpInternalTlsDistinguishedNameParser *self = [ComSquareupOkhttpInternalTlsDistinguishedNameParser alloc];
  ComSquareupOkhttpInternalTlsDistinguishedNameParser_initWithJavaxSecurityAuthX500X500Principal_(self, principal);
  return self;
}

ComSquareupOkhttpInternalTlsDistinguishedNameParser *create_ComSquareupOkhttpInternalTlsDistinguishedNameParser_initWithJavaxSecurityAuthX500X500Principal_(JavaxSecurityAuthX500X500Principal *principal) {
  return new_ComSquareupOkhttpInternalTlsDistinguishedNameParser_initWithJavaxSecurityAuthX500X500Principal_(principal);
}

NSString *ComSquareupOkhttpInternalTlsDistinguishedNameParser_nextAT(ComSquareupOkhttpInternalTlsDistinguishedNameParser *self) {
  for (; self->pos_ < self->length_ && IOSCharArray_Get(nil_chk(self->chars_), self->pos_) == ' '; self->pos_++) {
  }
  if (self->pos_ == self->length_) {
    return nil;
  }
  self->beg_ = self->pos_;
  self->pos_++;
  for (; self->pos_ < self->length_ && IOSCharArray_Get(nil_chk(self->chars_), self->pos_) != '=' && IOSCharArray_Get(self->chars_, self->pos_) != ' '; self->pos_++) {
  }
  if (self->pos_ >= self->length_) {
    @throw new_JavaLangIllegalStateException_initWithNSString_(JreStrcat("$$", @"Unexpected end of DN: ", self->dn_));
  }
  self->end_ = self->pos_;
  if (IOSCharArray_Get(nil_chk(self->chars_), self->pos_) == ' ') {
    for (; self->pos_ < self->length_ && IOSCharArray_Get(self->chars_, self->pos_) != '=' && IOSCharArray_Get(self->chars_, self->pos_) == ' '; self->pos_++) {
    }
    if (IOSCharArray_Get(self->chars_, self->pos_) != '=' || self->pos_ == self->length_) {
      @throw new_JavaLangIllegalStateException_initWithNSString_(JreStrcat("$$", @"Unexpected end of DN: ", self->dn_));
    }
  }
  self->pos_++;
  for (; self->pos_ < self->length_ && IOSCharArray_Get(self->chars_, self->pos_) == ' '; self->pos_++) {
  }
  if ((self->end_ - self->beg_ > 4) && (IOSCharArray_Get(self->chars_, self->beg_ + 3) == '.') && (IOSCharArray_Get(self->chars_, self->beg_) == 'O' || IOSCharArray_Get(self->chars_, self->beg_) == 'o') && (IOSCharArray_Get(self->chars_, self->beg_ + 1) == 'I' || IOSCharArray_Get(self->chars_, self->beg_ + 1) == 'i') && (IOSCharArray_Get(self->chars_, self->beg_ + 2) == 'D' || IOSCharArray_Get(self->chars_, self->beg_ + 2) == 'd')) {
    self->beg_ += 4;
  }
  return [NSString stringWithCharacters:self->chars_ offset:self->beg_ length:self->end_ - self->beg_];
}

NSString *ComSquareupOkhttpInternalTlsDistinguishedNameParser_quotedAV(ComSquareupOkhttpInternalTlsDistinguishedNameParser *self) {
  self->pos_++;
  self->beg_ = self->pos_;
  self->end_ = self->beg_;
  while (true) {
    if (self->pos_ == self->length_) {
      @throw new_JavaLangIllegalStateException_initWithNSString_(JreStrcat("$$", @"Unexpected end of DN: ", self->dn_));
    }
    if (IOSCharArray_Get(nil_chk(self->chars_), self->pos_) == '"') {
      self->pos_++;
      break;
    }
    else if (IOSCharArray_Get(self->chars_, self->pos_) == '\\') {
      *IOSCharArray_GetRef(self->chars_, self->end_) = ComSquareupOkhttpInternalTlsDistinguishedNameParser_getEscaped(self);
    }
    else {
      *IOSCharArray_GetRef(self->chars_, self->end_) = IOSCharArray_Get(self->chars_, self->pos_);
    }
    self->pos_++;
    self->end_++;
  }
  for (; self->pos_ < self->length_ && IOSCharArray_Get(nil_chk(self->chars_), self->pos_) == ' '; self->pos_++) {
  }
  return [NSString stringWithCharacters:self->chars_ offset:self->beg_ length:self->end_ - self->beg_];
}

NSString *ComSquareupOkhttpInternalTlsDistinguishedNameParser_hexAV(ComSquareupOkhttpInternalTlsDistinguishedNameParser *self) {
  if (self->pos_ + 4 >= self->length_) {
    @throw new_JavaLangIllegalStateException_initWithNSString_(JreStrcat("$$", @"Unexpected end of DN: ", self->dn_));
  }
  self->beg_ = self->pos_;
  self->pos_++;
  while (true) {
    if (self->pos_ == self->length_ || IOSCharArray_Get(nil_chk(self->chars_), self->pos_) == '+' || IOSCharArray_Get(self->chars_, self->pos_) == ',' || IOSCharArray_Get(self->chars_, self->pos_) == ';') {
      self->end_ = self->pos_;
      break;
    }
    if (IOSCharArray_Get(nil_chk(self->chars_), self->pos_) == ' ') {
      self->end_ = self->pos_;
      self->pos_++;
      for (; self->pos_ < self->length_ && IOSCharArray_Get(self->chars_, self->pos_) == ' '; self->pos_++) {
      }
      break;
    }
    else if (IOSCharArray_Get(self->chars_, self->pos_) >= 'A' && IOSCharArray_Get(self->chars_, self->pos_) <= 'F') {
      *IOSCharArray_GetRef(self->chars_, self->pos_) += 32;
    }
    self->pos_++;
  }
  jint hexLen = self->end_ - self->beg_;
  if (hexLen < 5 || (hexLen & 1) == 0) {
    @throw new_JavaLangIllegalStateException_initWithNSString_(JreStrcat("$$", @"Unexpected end of DN: ", self->dn_));
  }
  IOSByteArray *encoded = [IOSByteArray newArrayWithLength:hexLen / 2];
  for (jint i = 0, p = self->beg_ + 1; i < encoded->size_; p += 2, i++) {
    *IOSByteArray_GetRef(encoded, i) = (jbyte) ComSquareupOkhttpInternalTlsDistinguishedNameParser_getByteWithInt_(self, p);
  }
  return [NSString stringWithCharacters:self->chars_ offset:self->beg_ length:hexLen];
}

NSString *ComSquareupOkhttpInternalTlsDistinguishedNameParser_escapedAV(ComSquareupOkhttpInternalTlsDistinguishedNameParser *self) {
  self->beg_ = self->pos_;
  self->end_ = self->pos_;
  while (true) {
    if (self->pos_ >= self->length_) {
      return [NSString stringWithCharacters:self->chars_ offset:self->beg_ length:self->end_ - self->beg_];
    }
    switch (IOSCharArray_Get(nil_chk(self->chars_), self->pos_)) {
      case '+':
      case ',':
      case ';':
      return [NSString stringWithCharacters:self->chars_ offset:self->beg_ length:self->end_ - self->beg_];
      case '\\':
      *IOSCharArray_GetRef(self->chars_, self->end_++) = ComSquareupOkhttpInternalTlsDistinguishedNameParser_getEscaped(self);
      self->pos_++;
      break;
      case ' ':
      self->cur_ = self->end_;
      self->pos_++;
      *IOSCharArray_GetRef(self->chars_, self->end_++) = ' ';
      for (; self->pos_ < self->length_ && IOSCharArray_Get(self->chars_, self->pos_) == ' '; self->pos_++) {
        *IOSCharArray_GetRef(self->chars_, self->end_++) = ' ';
      }
      if (self->pos_ == self->length_ || IOSCharArray_Get(self->chars_, self->pos_) == ',' || IOSCharArray_Get(self->chars_, self->pos_) == '+' || IOSCharArray_Get(self->chars_, self->pos_) == ';') {
        return [NSString stringWithCharacters:self->chars_ offset:self->beg_ length:self->cur_ - self->beg_];
      }
      break;
      default:
      *IOSCharArray_GetRef(self->chars_, self->end_++) = IOSCharArray_Get(self->chars_, self->pos_);
      self->pos_++;
    }
  }
}

jchar ComSquareupOkhttpInternalTlsDistinguishedNameParser_getEscaped(ComSquareupOkhttpInternalTlsDistinguishedNameParser *self) {
  self->pos_++;
  if (self->pos_ == self->length_) {
    @throw new_JavaLangIllegalStateException_initWithNSString_(JreStrcat("$$", @"Unexpected end of DN: ", self->dn_));
  }
  switch (IOSCharArray_Get(nil_chk(self->chars_), self->pos_)) {
    case '"':
    case '\\':
    case ',':
    case '=':
    case '+':
    case '<':
    case '>':
    case '#':
    case ';':
    case ' ':
    case '*':
    case '%':
    case '_':
    return IOSCharArray_Get(self->chars_, self->pos_);
    default:
    return ComSquareupOkhttpInternalTlsDistinguishedNameParser_getUTF8(self);
  }
}

jchar ComSquareupOkhttpInternalTlsDistinguishedNameParser_getUTF8(ComSquareupOkhttpInternalTlsDistinguishedNameParser *self) {
  jint res = ComSquareupOkhttpInternalTlsDistinguishedNameParser_getByteWithInt_(self, self->pos_);
  self->pos_++;
  if (res < 128) {
    return (jchar) res;
  }
  else if (res >= 192 && res <= 247) {
    jint count;
    if (res <= 223) {
      count = 1;
      res = res & (jint) 0x1F;
    }
    else if (res <= 239) {
      count = 2;
      res = res & (jint) 0x0F;
    }
    else {
      count = 3;
      res = res & (jint) 0x07;
    }
    jint b;
    for (jint i = 0; i < count; i++) {
      self->pos_++;
      if (self->pos_ == self->length_ || IOSCharArray_Get(nil_chk(self->chars_), self->pos_) != '\\') {
        return (jint) 0x3F;
      }
      self->pos_++;
      b = ComSquareupOkhttpInternalTlsDistinguishedNameParser_getByteWithInt_(self, self->pos_);
      self->pos_++;
      if ((b & (jint) 0xC0) != (jint) 0x80) {
        return (jint) 0x3F;
      }
      res = (JreLShift32(res, 6)) + (b & (jint) 0x3F);
    }
    return (jchar) res;
  }
  else {
    return (jint) 0x3F;
  }
}

jint ComSquareupOkhttpInternalTlsDistinguishedNameParser_getByteWithInt_(ComSquareupOkhttpInternalTlsDistinguishedNameParser *self, jint position) {
  if (position + 1 >= self->length_) {
    @throw new_JavaLangIllegalStateException_initWithNSString_(JreStrcat("$$", @"Malformed DN: ", self->dn_));
  }
  jint b1, b2;
  b1 = IOSCharArray_Get(nil_chk(self->chars_), position);
  if (b1 >= '0' && b1 <= '9') {
    b1 = b1 - '0';
  }
  else if (b1 >= 'a' && b1 <= 'f') {
    b1 = b1 - 87;
  }
  else if (b1 >= 'A' && b1 <= 'F') {
    b1 = b1 - 55;
  }
  else {
    @throw new_JavaLangIllegalStateException_initWithNSString_(JreStrcat("$$", @"Malformed DN: ", self->dn_));
  }
  b2 = IOSCharArray_Get(self->chars_, position + 1);
  if (b2 >= '0' && b2 <= '9') {
    b2 = b2 - '0';
  }
  else if (b2 >= 'a' && b2 <= 'f') {
    b2 = b2 - 87;
  }
  else if (b2 >= 'A' && b2 <= 'F') {
    b2 = b2 - 55;
  }
  else {
    @throw new_JavaLangIllegalStateException_initWithNSString_(JreStrcat("$$", @"Malformed DN: ", self->dn_));
  }
  return (JreLShift32(b1, 4)) + b2;
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(ComSquareupOkhttpInternalTlsDistinguishedNameParser)
