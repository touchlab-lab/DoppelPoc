//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: /Users/kgalligan/devel/xp/SharedPodsFixHistory/SimpleDaggerApp/lib/src/main/java/co/touchlab/simpledaggerapp/NoteStorage.java
//

#include "IOSClass.h"
#include "IOSObjectArray.h"
#include "J2ObjC_source.h"
#include "co/touchlab/simpledaggerapp/Note.h"
#include "co/touchlab/simpledaggerapp/NoteStorage.h"
#include "co/touchlab/simpledaggerapp/PlatformContext.h"
#include "com/google/gson/Gson.h"
#include "java/io/BufferedReader.h"
#include "java/io/BufferedWriter.h"
#include "java/io/File.h"
#include "java/io/FileReader.h"
#include "java/io/FileWriter.h"
#include "java/io/FilenameFilter.h"
#include "java/io/IOException.h"
#include "java/lang/Long.h"
#include "java/lang/RuntimeException.h"
#include "java/lang/System.h"
#include "java/util/ArrayList.h"
#include "java/util/List.h"
#include "javax/inject/Inject.h"

@interface CoTouchlabSimpledaggerappNoteStorage () {
 @public
  id<CoTouchlabSimpledaggerappPlatformContext> platformContext_;
}

- (JavaIoFile *)noteFileWithCoTouchlabSimpledaggerappNote:(CoTouchlabSimpledaggerappNote *)note;

- (NSString *)noteFilenameWithCoTouchlabSimpledaggerappNote:(CoTouchlabSimpledaggerappNote *)note;

@end

J2OBJC_FIELD_SETTER(CoTouchlabSimpledaggerappNoteStorage, platformContext_, id<CoTouchlabSimpledaggerappPlatformContext>)

__attribute__((unused)) static JavaIoFile *CoTouchlabSimpledaggerappNoteStorage_noteFileWithCoTouchlabSimpledaggerappNote_(CoTouchlabSimpledaggerappNoteStorage *self, CoTouchlabSimpledaggerappNote *note);

__attribute__((unused)) static NSString *CoTouchlabSimpledaggerappNoteStorage_noteFilenameWithCoTouchlabSimpledaggerappNote_(CoTouchlabSimpledaggerappNoteStorage *self, CoTouchlabSimpledaggerappNote *note);

@interface CoTouchlabSimpledaggerappNoteStorage_$1 : NSObject < JavaIoFilenameFilter >

- (jboolean)acceptWithJavaIoFile:(JavaIoFile *)dir
                    withNSString:(NSString *)name;

- (instancetype)init;

@end

J2OBJC_EMPTY_STATIC_INIT(CoTouchlabSimpledaggerappNoteStorage_$1)

__attribute__((unused)) static void CoTouchlabSimpledaggerappNoteStorage_$1_init(CoTouchlabSimpledaggerappNoteStorage_$1 *self);

__attribute__((unused)) static CoTouchlabSimpledaggerappNoteStorage_$1 *new_CoTouchlabSimpledaggerappNoteStorage_$1_init() NS_RETURNS_RETAINED;

__attribute__((unused)) static CoTouchlabSimpledaggerappNoteStorage_$1 *create_CoTouchlabSimpledaggerappNoteStorage_$1_init();

J2OBJC_TYPE_LITERAL_HEADER(CoTouchlabSimpledaggerappNoteStorage_$1)

NSString *CoTouchlabSimpledaggerappNoteStorage_NOTE_PREFIX = @"note_";

@implementation CoTouchlabSimpledaggerappNoteStorage

- (instancetype)initWithCoTouchlabSimpledaggerappPlatformContext:(id<CoTouchlabSimpledaggerappPlatformContext>)platformContext {
  CoTouchlabSimpledaggerappNoteStorage_initWithCoTouchlabSimpledaggerappPlatformContext_(self, platformContext);
  return self;
}

- (void)saveWithCoTouchlabSimpledaggerappNote:(CoTouchlabSimpledaggerappNote *)note {
  @try {
    if ([((CoTouchlabSimpledaggerappNote *) nil_chk(note)) getId] == nil) [note setIdWithJavaLangLong:JavaLangLong_valueOfWithLong_(JavaLangSystem_currentTimeMillis())];
    JavaIoFile *savedFile = CoTouchlabSimpledaggerappNoteStorage_noteFileWithCoTouchlabSimpledaggerappNote_(self, note);
    NSString *jsonString = [new_ComGoogleGsonGson_init() toJsonWithId:note];
    JavaIoBufferedWriter *bufferedWriter = new_JavaIoBufferedWriter_initWithJavaIoWriter_(new_JavaIoFileWriter_initWithJavaIoFile_(savedFile));
    [bufferedWriter writeWithNSString:jsonString];
    [bufferedWriter close];
  }
  @catch (JavaIoIOException *e) {
    @throw new_JavaLangRuntimeException_initWithNSException_(e);
  }
}

- (void)removeWithCoTouchlabSimpledaggerappNote:(CoTouchlabSimpledaggerappNote *)note {
  [((JavaIoFile *) nil_chk(CoTouchlabSimpledaggerappNoteStorage_noteFileWithCoTouchlabSimpledaggerappNote_(self, note))) delete__];
}

- (id<JavaUtilList>)allNotes {
  @try {
    IOSObjectArray *fileList = [((JavaIoFile *) nil_chk([((id<CoTouchlabSimpledaggerappPlatformContext>) nil_chk(platformContext_)) storageDir])) listFilesWithJavaIoFilenameFilter:new_CoTouchlabSimpledaggerappNoteStorage_$1_init()];
    id<JavaUtilList> notes = new_JavaUtilArrayList_initWithInt_(((IOSObjectArray *) nil_chk(fileList))->size_);
    ComGoogleGsonGson *gson = new_ComGoogleGsonGson_init();
    {
      IOSObjectArray *a__ = fileList;
      JavaIoFile * const *b__ = a__->buffer_;
      JavaIoFile * const *e__ = b__ + a__->size_;
      while (b__ < e__) {
        JavaIoFile *noteFile = *b__++;
        JavaIoBufferedReader *bufferedReader = new_JavaIoBufferedReader_initWithJavaIoReader_(new_JavaIoFileReader_initWithJavaIoFile_(noteFile));
        NSString *noteString = [bufferedReader readLine];
        [notes addWithId:[gson fromJsonWithNSString:noteString withIOSClass:CoTouchlabSimpledaggerappNote_class_()]];
      }
    }
    return notes;
  }
  @catch (JavaIoIOException *e) {
    @throw new_JavaLangRuntimeException_initWithNSException_(e);
  }
}

- (JavaIoFile *)noteFileWithCoTouchlabSimpledaggerappNote:(CoTouchlabSimpledaggerappNote *)note {
  return CoTouchlabSimpledaggerappNoteStorage_noteFileWithCoTouchlabSimpledaggerappNote_(self, note);
}

- (NSString *)noteFilenameWithCoTouchlabSimpledaggerappNote:(CoTouchlabSimpledaggerappNote *)note {
  return CoTouchlabSimpledaggerappNoteStorage_noteFilenameWithCoTouchlabSimpledaggerappNote_(self, note);
}

+ (IOSObjectArray *)__annotations_initWithCoTouchlabSimpledaggerappPlatformContext_ {
  return [IOSObjectArray arrayWithObjects:(id[]) { [[JavaxInjectInject alloc] init] } count:1 type:JavaLangAnnotationAnnotation_class_()];
}

+ (const J2ObjcClassInfo *)__metadata {
  static const J2ObjcMethodInfo methods[] = {
    { "initWithCoTouchlabSimpledaggerappPlatformContext:", "NoteStorage", NULL, 0x1, NULL, NULL },
    { "saveWithCoTouchlabSimpledaggerappNote:", "save", "V", 0x1, NULL, NULL },
    { "removeWithCoTouchlabSimpledaggerappNote:", "remove", "V", 0x1, NULL, NULL },
    { "allNotes", NULL, "Ljava.util.List;", 0x1, NULL, "()Ljava/util/List<Lco/touchlab/simpledaggerapp/Note;>;" },
    { "noteFileWithCoTouchlabSimpledaggerappNote:", "noteFile", "Ljava.io.File;", 0x2, NULL, NULL },
    { "noteFilenameWithCoTouchlabSimpledaggerappNote:", "noteFilename", "Ljava.lang.String;", 0x2, NULL, NULL },
  };
  static const J2ObjcFieldInfo fields[] = {
    { "NOTE_PREFIX", "NOTE_PREFIX", 0x19, "Ljava.lang.String;", &CoTouchlabSimpledaggerappNoteStorage_NOTE_PREFIX, NULL, .constantValue.asLong = 0 },
    { "platformContext_", NULL, 0x12, "Lco.touchlab.simpledaggerapp.PlatformContext;", NULL, NULL, .constantValue.asLong = 0 },
  };
  static const J2ObjcClassInfo _CoTouchlabSimpledaggerappNoteStorage = { 2, "NoteStorage", "co.touchlab.simpledaggerapp", NULL, 0x1, 6, methods, 2, fields, 0, NULL, 0, NULL, NULL, NULL };
  return &_CoTouchlabSimpledaggerappNoteStorage;
}

@end

void CoTouchlabSimpledaggerappNoteStorage_initWithCoTouchlabSimpledaggerappPlatformContext_(CoTouchlabSimpledaggerappNoteStorage *self, id<CoTouchlabSimpledaggerappPlatformContext> platformContext) {
  NSObject_init(self);
  self->platformContext_ = platformContext;
}

CoTouchlabSimpledaggerappNoteStorage *new_CoTouchlabSimpledaggerappNoteStorage_initWithCoTouchlabSimpledaggerappPlatformContext_(id<CoTouchlabSimpledaggerappPlatformContext> platformContext) {
  CoTouchlabSimpledaggerappNoteStorage *self = [CoTouchlabSimpledaggerappNoteStorage alloc];
  CoTouchlabSimpledaggerappNoteStorage_initWithCoTouchlabSimpledaggerappPlatformContext_(self, platformContext);
  return self;
}

CoTouchlabSimpledaggerappNoteStorage *create_CoTouchlabSimpledaggerappNoteStorage_initWithCoTouchlabSimpledaggerappPlatformContext_(id<CoTouchlabSimpledaggerappPlatformContext> platformContext) {
  return new_CoTouchlabSimpledaggerappNoteStorage_initWithCoTouchlabSimpledaggerappPlatformContext_(platformContext);
}

JavaIoFile *CoTouchlabSimpledaggerappNoteStorage_noteFileWithCoTouchlabSimpledaggerappNote_(CoTouchlabSimpledaggerappNoteStorage *self, CoTouchlabSimpledaggerappNote *note) {
  return new_JavaIoFile_initWithJavaIoFile_withNSString_([((id<CoTouchlabSimpledaggerappPlatformContext>) nil_chk(self->platformContext_)) storageDir], CoTouchlabSimpledaggerappNoteStorage_noteFilenameWithCoTouchlabSimpledaggerappNote_(self, note));
}

NSString *CoTouchlabSimpledaggerappNoteStorage_noteFilenameWithCoTouchlabSimpledaggerappNote_(CoTouchlabSimpledaggerappNoteStorage *self, CoTouchlabSimpledaggerappNote *note) {
  return JreStrcat("$@$", CoTouchlabSimpledaggerappNoteStorage_NOTE_PREFIX, [((CoTouchlabSimpledaggerappNote *) nil_chk(note)) getId], @".json");
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(CoTouchlabSimpledaggerappNoteStorage)

@implementation CoTouchlabSimpledaggerappNoteStorage_$1

- (jboolean)acceptWithJavaIoFile:(JavaIoFile *)dir
                    withNSString:(NSString *)name {
  return [((NSString *) nil_chk(name)) hasPrefix:CoTouchlabSimpledaggerappNoteStorage_NOTE_PREFIX];
}

J2OBJC_IGNORE_DESIGNATED_BEGIN
- (instancetype)init {
  CoTouchlabSimpledaggerappNoteStorage_$1_init(self);
  return self;
}
J2OBJC_IGNORE_DESIGNATED_END

+ (const J2ObjcClassInfo *)__metadata {
  static const J2ObjcMethodInfo methods[] = {
    { "acceptWithJavaIoFile:withNSString:", "accept", "Z", 0x1, NULL, NULL },
    { "init", "", NULL, 0x0, NULL, NULL },
  };
  static const J2ObjCEnclosingMethodInfo enclosing_method = { "CoTouchlabSimpledaggerappNoteStorage", "allNotes" };
  static const J2ObjcClassInfo _CoTouchlabSimpledaggerappNoteStorage_$1 = { 2, "", "co.touchlab.simpledaggerapp", "NoteStorage", 0x8008, 2, methods, 0, NULL, 0, NULL, 0, NULL, &enclosing_method, NULL };
  return &_CoTouchlabSimpledaggerappNoteStorage_$1;
}

@end

void CoTouchlabSimpledaggerappNoteStorage_$1_init(CoTouchlabSimpledaggerappNoteStorage_$1 *self) {
  NSObject_init(self);
}

CoTouchlabSimpledaggerappNoteStorage_$1 *new_CoTouchlabSimpledaggerappNoteStorage_$1_init() {
  CoTouchlabSimpledaggerappNoteStorage_$1 *self = [CoTouchlabSimpledaggerappNoteStorage_$1 alloc];
  CoTouchlabSimpledaggerappNoteStorage_$1_init(self);
  return self;
}

CoTouchlabSimpledaggerappNoteStorage_$1 *create_CoTouchlabSimpledaggerappNoteStorage_$1_init() {
  return new_CoTouchlabSimpledaggerappNoteStorage_$1_init();
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(CoTouchlabSimpledaggerappNoteStorage_$1)
